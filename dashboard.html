<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard de datos Â· TAG-Porsche TTE PO1 XR Engine Lab</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#020617" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32.png" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="top-bar">
  <div class="brand">
    <span class="brand-mark">ğŸ</span>
    <span class="brand-text">TAG-Porsche TTE PO1 XR Lab</span>
  </div>
  <nav class="main-nav">
    <a href="index.html" class="nav-btn">ğŸ  Inicio</a>
    <a href="viewer3D/tte-po1-3d.html" class="nav-btn accent">ğŸ‘ï¸ 3D</a>
    <a href="viewerAR/tte-po1-ar.html" class="nav-btn accent">ğŸ“± AR</a>
    <a href="viewerVR/tte-po1-vr.html" class="nav-btn accent">ğŸ¥½ VR</a>
  </nav>
  <div class="accessibility-controls">
    <button class="ctrl-btn" data-action="toggle-tts" title="Narrador">ğŸ—£ï¸</button>
    <button class="ctrl-btn" data-action="toggle-theme" title="Modo claro/oscuro">ğŸŒ“</button>
    <button class="ctrl-btn" data-action="font-inc" title="Aumentar tamaÃ±o de letra">A+</button>
    <button class="ctrl-btn" data-action="font-dec" title="Disminuir tamaÃ±o de letra">Aâˆ’</button>
    <button class="ctrl-btn" data-action="toggle-lang" title="Cambiar idioma ES/EN">ğŸŒ</button>
    <button class="ctrl-btn" data-action="focus-kpsi" title="Panel de datos">ğŸ§ </button>
    <button class="ctrl-btn" data-action="focus-search" title="Buscar en la pÃ¡gina">ğŸ”</button>
  </div>
</header>
  <main id="main-content" class="layout">    <section class="card">
      <h1>ğŸ“Š Dashboard de datos Â· TTE PO1</h1>
      <p>
        AquÃ­ puedes visualizar y <strong>editar en vivo</strong> la comparaciÃ³n entre el motor
        <strong>TAG-Porsche TTE PO1</strong> y un motor turbo de calle usando la plantilla
        <code>tte_po1_comparativa.csv</code>.
      </p>
      <ol class="edu-list">
        <li>Usa este dashboard como demostraciÃ³n rÃ¡pida en clase.</li>
        <li>Pide al curso que modifique los valores directamente en la tabla de abajo.</li>
        <li>Al presionar <strong>â€œğŸ”„ Actualizar grÃ¡ficosâ€</strong> verÃ¡n cÃ³mo cambian las barras.</li>
      </ol>
    </section>

    <section class="card">
      <h2>âš™ï¸ GrÃ¡fico 1: Potencia comparada</h2>
      <p>Potencia aproximada en caballos de fuerza (hp) para cada configuraciÃ³n de motor.</p>
      <div class="chart-wrapper">
        <canvas id="chartPotencia" aria-label="GrÃ¡fico de potencia en hp" role="img"></canvas>
      </div>
    </section>

    <section class="card">
      <h2>ğŸŒ€ GrÃ¡fico 2: rpm y presiÃ³n de turbo</h2>
      <p>RelaciÃ³n entre el rÃ©gimen mÃ¡ximo de giro y la presiÃ³n de turbo estimada en cada caso.</p>
      <div class="chart-wrapper">
        <canvas id="chartRpmTurbo" aria-label="GrÃ¡fico de rpm y presiÃ³n de turbo" role="img"></canvas>
      </div>
      <p class="note">
        Recuerda que estos valores son aproximados y estÃ¡n pensados con fines educativos; ajusta la tabla
        si trabajas con datos mÃ¡s precisos o con otros motores.
      </p>
    </section>

    <section class="card">
      <h2>âœï¸ Editor de datos en el navegador</h2>
      <p>
        Edita aquÃ­ las etiquetas, potencia, rpm y presiÃ³n de turbo. Los cambios <strong>no modifican el CSV original</strong>,
        solo viven en esta sesiÃ³n y sirven para experimentar en clase.
      </p>
      <div class="table-scroll">
        <table id="tablaEditor" class="data-table">
          <thead>
            <tr>
              <th>Etiqueta</th>
              <th>Potencia (hp)</th>
              <th>rpm mÃ¡x.</th>
              <th>PresiÃ³n turbo (bar)</th>
            </tr>
          </thead>
          <tbody>
            <!-- filas generadas por JS -->
          </tbody>
        </table>
      </div>
      <button id="btnActualizar" class="cta-btn small">ğŸ”„ Actualizar grÃ¡ficos</button>
      <p class="note">
        Sugerencia: pide al curso que simule un â€œmodo lluviaâ€, â€œmodo ahorroâ€ o â€œnuevo motorâ€ ajustando los valores,
        y luego comparen los resultados en los grÃ¡ficos.
      </p>
    </section>

    <section class="card">
      <h2>ğŸ“‚ Archivo de datos utilizado</h2>
      <p>
        El dashboard lee el archivo <code>assets/data/tte_po1_comparativa.csv</code> (separado por punto y coma)
        como punto de partida. Puedes descargarlo, editarlo y volver a cargar la pÃ¡gina si quieres restablecer los
        valores originales.
      </p>
      <a href="assets/data/tte_po1_comparativa.csv" download class="cta-btn small">âœ… Descargar CSV original</a>
    </section>

</main>

  <footer class="site-footer">
  <p>Neotech EduLab SpA â€” EducaciÃ³n Inmersiva &amp; I+D ğŸš€</p>
  <p>Proyecto: TAG-Porsche TTE PO1 XR Engine Lab Â· Motor de FÃ³rmula 1 para uso educativo.</p>
  <p>Contacto: Francisco Pinto &amp; BelÃ©n AcuÃ±a Â· neotechedulab@gmail.com</p>
</footer>
  <script src="js/main.js"></script>
  <script>
    (function() {
      const CSV_URL = 'assets/data/tte_po1_comparativa.csv';
      let chartPotencia = null;
      let chartRpmTurbo = null;

      function parseCsv(text) {
        const lines = text.trim().split(/\r?\n/);
        if (!lines.length) return { headers: [], rows: [] };
        const headers = lines[0].split(';').map(h => h.trim());
        const rows = lines.slice(1).map(line => line.split(';').map(c => c.trim()));
        return { headers, rows };
      }

      function renderTable(labels, potencias, rpms, turbos) {
        const tbody = document.querySelector('#tablaEditor tbody');
        if (!tbody) return;
        tbody.innerHTML = '';
        for (let i = 0; i < labels.length; i++) {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><input type="text" class="inp-etiqueta" value="${labels[i] ?? ''}"></td>
            <td><input type="number" class="inp-potencia" value="${potencias[i] ?? 0}" step="10"></td>
            <td><input type="number" class="inp-rpm" value="${rpms[i] ?? 0}" step="100"></td>
            <td><input type="number" class="inp-turbo" value="${turbos[i] ?? 0}" step="0.1"></td>
          `;
          tbody.appendChild(tr);
        }
      }

      function buildChartsFromArrays(labels, potencias, rpms, turbos) {
        const ctxPot = document.getElementById('chartPotencia')?.getContext('2d');
        const ctxRpm = document.getElementById('chartRpmTurbo')?.getContext('2d');
        if (!ctxPot || !ctxRpm) return;

        if (chartPotencia) chartPotencia.destroy();
        if (chartRpmTurbo) chartRpmTurbo.destroy();

        chartPotencia = new Chart(ctxPot, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Potencia (hp aprox.)',
              data: potencias,
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: 'hp' }
              }
            }
          }
        });

        chartRpmTurbo = new Chart(ctxRpm, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'rpm mÃ¡x.',
                data: rpms,
                borderWidth: 1,
                yAxisID: 'y'
              },
              {
                label: 'PresiÃ³n de turbo (bar)',
                data: turbos,
                borderWidth: 1,
                yAxisID: 'y1'
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                position: 'left',
                title: { display: true, text: 'rpm' }
              },
              y1: {
                beginAtZero: true,
                position: 'right',
                grid: { drawOnChartArea: false },
                title: { display: true, text: 'bar' }
              }
            }
          }
        });
      }

      function buildFromData(data) {
        const idxEtiqueta = data.headers.indexOf('etiqueta');
        const idxPotencia = data.headers.indexOf('potencia_hp');
        const idxRpm = data.headers.indexOf('rpm_max');
        const idxTurbo = data.headers.indexOf('presion_turbo_bar');

        const etiquetas = data.rows.map(r => r[idxEtiqueta]);
        const potencias = data.rows.map(r => Number(r[idxPotencia] || 0));
        const rpms = data.rows.map(r => Number(r[idxRpm] || 0));
        const turbos = data.rows.map(r => Number(r[idxTurbo] || 0));

        renderTable(etiquetas, potencias, rpms, turbos);
        buildChartsFromArrays(etiquetas, potencias, rpms, turbos);
      }

      function readTableAndUpdate() {
        const tbody = document.querySelector('#tablaEditor tbody');
        if (!tbody) return;
        const etiquetas = [];
        const potencias = [];
        const rpms = [];
        const turbos = [];
        tbody.querySelectorAll('tr').forEach(tr => {
          const e = tr.querySelector('.inp-etiqueta');
          const p = tr.querySelector('.inp-potencia');
          const r = tr.querySelector('.inp-rpm');
          const t = tr.querySelector('.inp-turbo');
          etiquetas.push(e ? e.value : '');
          potencias.push(p ? Number(p.value || 0) : 0);
          rpms.push(r ? Number(r.value || 0) : 0);
          turbos.push(t ? Number(t.value || 0) : 0);
        });
        buildChartsFromArrays(etiquetas, potencias, rpms, turbos);
      }

      document.addEventListener('DOMContentLoaded', function() {
        fetch(CSV_URL)
          .then(r => r.text())
          .then(text => buildFromData(parseCsv(text)))
          .catch(err => console.error('Error al cargar CSV:', err));

        const btn = document.getElementById('btnActualizar');
        if (btn) {
          btn.addEventListener('click', function() {
            readTableAndUpdate();
          });
        }
      });
    })();
  </script>
</body>
</html>
